services:
  # ── Flyway Migrations ────────────────────────────────────
  # Runs against the shared sc-postgres container from
  # the parent SportsCircuit docker-compose stack.
  flyway:
    image: flyway/flyway:11-alpine
    container_name: devops-portal-flyway
    networks:
      - sc-net
    environment:
      FLYWAY_URL: jdbc:postgresql://sc-postgres:5432/${DB_NAME:-sports_circuit}
      FLYWAY_USER: ${DB_USER:-sports}
      FLYWAY_PASSWORD: ${DB_PASSWORD:-sports_secret}
    volumes:
      - ./flyway/sql:/flyway/sql:ro
      - ./flyway/conf:/flyway/conf:ro
    command: migrate

networks:
  sc-net:
    external: true
    name: sports-circuit-net
